<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Order Application</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        background-color: rgb(42, 11, 195);
        font-size: 12px;
      }

      .flex-container {
        display: flex;
        height: 100vh;
      }

      .flex-container > div {
        background-color: blueviolet;
        margin: 10px;
        padding: 20px;
        font-size: 30px;
        width: 25%, 50%;
        flex: 1;
      }

      #displayArea1 {
        background-color: rgb(4, 146, 33);
        width: 55%;
        height: 3500px;
      }

      #app {
        background-color: blueviolet;
        width: 45%;
        height: 3500px;
      }

      h3 {
        color: #e9534bda;
        margin-bottom: 0.1em;
        margin-right: 10px;
      }

      h3,
      p {
        display: inline-block;
      }

      h4 {
        text-decoration: underline;
        font-style: italic;
        margin-bottom: 0.3em;
      }

      .previous {
        color: #eabc47;
      }

      .modified {
        color: #0e42cf;
      }

      button {
        background-color: lightblue;
        margin-top: 1.2em;
        margin-left: 3em;
        padding: 1rem 2rem;
        border: none;
        border-radius: 0.5rem;
        color: rgb(99, 187, 89);
        font-size: 1.3em;
        font-weight: bold;
        display: block;
        width: 30%;
        text-align: center;
        cursor: pointer;

        &:hover {
          filter: brightness(120%);
        }
      }

      label {
        display: block;
        padding-bottom: 0.5px;
        font-size: 0.75em;
      }

      input {
        display: block;
        margin-top: 0.01em;
        margin-bottom: 0.5em;
        /* outline: none; */
        outline: tomato;
        padding: 0.75em, 0em;
        /* border: none; */
        border: violet;
        border-radius: 10px;
        font-size: 0.75em;
        color: #2da615;
        min-width: 25%;
      }

      input:focus {
        background-color: #22de7a;
        color: #fff;
      }

      footer {
        clear: both;
        height: 100px;
        margin-top: 30px;
        text-align: center;
        background-color: honeydew;
      }

      .TO_ID {
        display: flex;
        align-items: center;
      }

      .heading3 {
        display: inline-block;
        margin-right: 10px;
        width: 45%;
        height: 1em;
        font-size: 1em;
      }

      input.text-field {
        display: inline-block;
        font-size: 0.6em;
        height: 1.5em;
      }
    </style>

    <title>Task Order App V3.0</title>
  </head>
  <body>
    <div class="flex-container">
      <div id="app">
        <div class="TO_ID">
          <h3 class="heading3">Previous Estimate:</h3>
          <input type="text" class="text-field" id="pEstimate" value="01A" />
        </div>

        <h4 class="previous">Preliminary Design Phase</h4>

        <form id="myForm">
          <label for="pfee">Preliminary Design Fee:</label>

          <input
            type="text"
            id="preli-fee1"
            class="accounting"
            name="preli-fee1"
            placeholder="Enter amount"
            pattern="^\$\d{1,3}(,\d{3})*(\.\d+)?$"
            value="0"
            data-type="currency"
          />

          <label for="pAllowance1"
            >Allowance for additional Preliminary Design services fee:</label
          >

          <input
            type="text"
            id="pAllowance1"
            class="accounting"
            name="pAllowance1"
            placeholder="Enter amount"
            value="0"
          />

          <!-- /*******************************************************/ -->
          <label for="pre-reimburse1"
            >Reimbursables for Preliminary design phase:</label
          >

          <input
            type="text"
            id="preli-reimburse1"
            class="accounting"
            name="preli-reimburse1"
            placeholder="Enter amount"
            value="0"
          />

          <label for="pArtwork1">Artwork for Preliminary design phase:</label>

          <input
            type="text"
            id="pArtwork1"
            class="accounting"
            name="pArtwork1"
            placeholder="Enter amount"
            value="0"
          />

          <label for="pCSS1"
            >Construction support services for Preliminary design phase:</label
          >

          <input
            type="text"
            id="pCSS1"
            class="accounting"
            name="pCSS1"
            placeholder="Enter amount"
            value="0"
          />

          <!-- /***************** Previous Estimate: Final Design Phase ***************/ -->

          <h4 class="previous">Final Design Phase</h4>
          <label for="ffee1">Final Design Fee:</label>

          <input
            type="text"
            id="final-fee1"
            class="accounting"
            name="final-fee1"
            placeholder="Enter amount"
            value="0"
          />

          <label for="fAllowance1"
            >Allowance for additional Final Design services fee:</label
          >

          <input
            type="text"
            id="fAllowance1"
            class="accounting"
            name="fAllowance1"
            placeholder="Enter amount"
            value="0"
          />

          <!-- /*******************************************************/ -->
          <label for="final-reimburse1"
            >Reimbursables for Final design phase:</label
          >

          <input
            type="text"
            id="final-reimburse1"
            class="accounting"
            name="final-reimburse1"
            placeholder="Enter amount"
            value="0"
          />

          <label for="fArtwork1">Artwork for Final design phase:</label>

          <input
            type="text"
            id="fArtwork1"
            class="accounting"
            name="fArtwork1"
            placeholder="Enter amount"
            value="0"
          />

          <label for="fCSS1"
            >Construction support services for Final design phase:</label
          >

          <input
            type="text"
            id="fCSS1"
            class="accounting"
            name="fCSS1"
            placeholder="Enter amount"
            value="0"
          />

          <!-- /***************** Modified Estimate: ***************/ -->

          <div class="TO_ID">
            <h3 class="heading3">Modified Estimate:</h3>
            <input
              type="text"
              class="text-field"
              id="mEstimate"
              value="01AS01"
            />
          </div>

          <h4 class="modified">Preliminary Design Phase</h4>

          <label for="pfee2">Preliminary Design Fee:</label>

          <input
            type="text"
            id="preli-fee2"
            class="accounting"
            name="preli-fee2"
            placeholder="Enter amount"
            value="0"
          />

          <label for="pAllowance2"
            >Allowance for additional Preliminary Design services fee:</label
          >

          <input
            type="text"
            id="pAllowance2"
            class="accounting"
            name="pAllowance2"
            placeholder="Enter amount"
            value="0"
          />

          <!-- /*******************************************************/ -->
          <label for="pre-reimburse2"
            >Reimbursables for Preliminary design phase:</label
          >

          <input
            type="text"
            id="preli-reimburse2"
            class="accounting"
            name="preli-reimburse2"
            placeholder="Enter amount"
            value="0"
          />

          <label for="pArtwork2">Artwork for Preliminary design phase:</label>

          <input
            type="text"
            id="pArtwork2"
            class="accounting"
            name="pArtwork2"
            placeholder="Enter amount"
            value="0"
          />

          <label for="pCSS2"
            >Construction support services for Preliminary design phase:</label
          >

          <input
            type="text"
            id="pCSS2"
            class="accounting"
            name="pCSS2"
            placeholder="Enter amount"
            value="0"
          />

          <!-- /***************** Modified Estimate: Final Design Phase ***************/ -->

          <h4 class="modified">Final Design Phase</h4>
          <label for="ffee2">Final Design Fee:</label>

          <input
            type="text"
            id="final-fee2"
            class="accounting"
            name="final-fee2"
            placeholder="Enter amount"
            value="0"
          />

          <label for="fAllowance2"
            >Allowance for additional Final Design services fee:</label
          >

          <input
            type="text"
            id="fAllowance2"
            class="accounting"
            name="fAllowance2"
            placeholder="Enter amount"
            value="0"
          />

          <!-- /*******************************************************/ -->
          <label for="final-reimburse2"
            >Reimbursables for Final design phase:</label
          >

          <input
            type="text"
            id="final-reimburse2"
            class="accounting"
            name="final-reimburse2"
            placeholder="Enter amount"
            value="0"
          />

          <label for="fArtwork2">Artwork for Final design phase:</label>

          <input
            type="text"
            id="fArtwork2"
            class="accounting"
            name="fArtwork2"
            placeholder="Enter amount"
            value="0"
          />

          <label for="fCSS2"
            >Construction support services for Final design phase:</label
          >

          <input
            type="text"
            id="fCSS2"
            class="accounting"
            name="fCSS2"
            placeholder="Enter amount"
            value="0"
          />

          <!-- /***************** Time extension wip: ***************/ -->

          <button type="button" id="btn">Submit</button>
        </form>
        <br />
      </div>
      <div id="displayArea1"></div>
    </div>

    <!-- /*****************************************************/ -->

    <script>
      function $(id) {
        return document.getElementById(id);
      }

      function $v(id) {
        return document.getElementById(id).value;
      }

      function q(cssSelector) {
        return document.querySelector(cssSelector).value;
      }

      let curr = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
        minimumFractionDigits: 2,
      });

      function f(num) {
        return curr.format(num);
      }

      function sum(...nums) {
        return nums.reduce((total, el) => total + el);
      }

      function toDecimal(num) {
        return num.toFixed(2);
      }

      function ifp(num, text) {
        if (num) {
          return text + f(num) + "<br>";
        } else {
          return "";
        }
      }

      function ifDel(num) {
        if (num) {
          return f(num) + "+";
        } else {
          return "";
        }
      }

      function ifp2(num1, num2, text) {
        if (num1 || num2) {
          return (
            text +
            f(num1) +
            "+" +
            f(num2) +
            ") = " +
            f(sum(num1, num2)) +
            "<br>"
          );
        } else {
          return "";
        }
      }

      function ifDel2(num1, num2) {
        if (num1 || num2) {
          return f(sum(num1, num2)) + "+";
        } else {
          return "";
        }
      }

      function ifDel2End(num1, num2) {
        if (num1 || num2) {
          return f(sum(num1, num2));
        } else {
          return "";
        }
      }

      function toNum(ID) {
        const valueInNumber = parseFloat(
          document.getElementById(ID).value.replace(/[^0-9.-]/g, "")
        );
        return valueInNumber;
      }

      $("btn").onclick = function () {
        var n1 = toNum("preli-fee1");
        var n2 = toNum("pAllowance1");
        var n3 = toNum("preli-reimburse1");
        var n4 = toNum("pArtwork1");
        var n5 = toNum("pCSS1");

        var n6 = toNum("final-fee1");
        var n7 = toNum("fAllowance1");
        var n8 = toNum("final-reimburse1");
        var n9 = toNum("fArtwork1");
        var n10 = toNum("fCSS1");

        var n11 = toNum("preli-fee2");
        var n12 = toNum("pAllowance2");
        var n13 = toNum("preli-reimburse2");
        var n14 = toNum("pArtwork2");
        var n15 = toNum("pCSS2");

        var n16 = toNum("final-fee2");
        var n17 = toNum("fAllowance2");
        var n18 = toNum("final-reimburse2");
        var n19 = toNum("fArtwork2");
        var n20 = toNum("fCSS2");

        var pest = $v("pEstimate");
        var mest = $v("mEstimate");

        $("displayArea1").innerHTML =
          "<h2>FEE SCHEDULE</h2>" +
          "<h3><b><u>Previous Estimate: </u></b></h3>" +
          "<p>" +
          pest +
          "</p><br>" +
          "<i><u>Preliminary Design Phase</i></u> <br>" +
          "Preliminary Design Fee: " +
          f(n1) +
          "<br>" +
          ifp(n2, "Allowances for Additional Preliminary Design Services: ") +
          "Sub-total of Preliminary Design Fee: " +
          f(sum(n1, n2)) +
          "<br><br>" +
          ifp(n3, "Reimbursable for Preliminary design phase: ") +
          ifp(n4, "Artwork for Preliminary design phase: ") +
          ifp(n5, "CSS for Preliminary design phase: ") +
          "Preliminary design phase not-to-exceed amount: " +
          f(sum(sum(n1, n2), n3, n4, n5)) +
          "<br><br>" +
          "<i><u>Final Design Phase</i></u> <br>" +
          "Final Design Fee: " +
          f(n6) +
          "<br>" +
          ifp(n7, "Allowances for Additional Final Design Services: ") +
          "Sub-total of Final Design Fee: " +
          f(sum(n6, n7)) +
          "<br><br>" +
          ifp(n8, "Reimbursable for the Final design phase: ") +
          ifp(n9, "Artwork for Final design phase: ") +
          ifp(n10, "CSS for Final design phase: ") +
          "Final design phase not-to-exceed amount: " +
          f(sum(sum(n6, n7), n8, n9, n10)) +
          "<br>" +
          "Total Preliminary and Final design phase NTE amount: (" +
          f(sum(sum(n1, n2), n3, n4, n5)) +
          " + " +
          f(sum(sum(n6, n7), n8, n9, n10)) +
          ") = " +
          f(sum(sum(sum(n1, n2), n3, n4, n5), sum(sum(n6, n7), n8, n9, n10))) +
          "<br>" +
          // /******************************************************************/
          "<h3><b><u>Modified Estimate:</u></b></h3>" +
          "<p>" +
          mest +
          "</p><br>" +
          "<i><u>Preliminary Design Phase</i></u> <br>" +
          ifp2(n1, n11, "Preliminary Design Fee: (") +
          ifp2(
            n2,
            n12,
            "Allowances for Additional Preliminary Design Services: ("
          ) +
          "Sub-total of Preliminary Design Fee: (" +
          ifDel2(n1, n11) +
          ifDel2End(n2, n12) +
          ") = " +
          f(sum(sum(n1, n11), sum(n2, n12))) +
          "<br><br>" +
          ifp2(n3, n13, "Reimbursable for Preliminary design phase: (") +
          ifp2(n4, n14, "Artwork for Preliminary design phase: (") +
          ifp2(n5, n15, "CSS for Preliminary design phase: (") +
          "Preliminary design phase not-to-exceed amount: (" +
          ifDel2(n1 + n11, n2 + n12) +
          ifDel2(n3, n13) +
          ifDel2(n4, n14) +
          ifDel2End(n5, n15) +
          ") = " +
          f(
            sum(
              sum(sum(n1, n11), sum(n2, n12)),
              sum(n3, n13),
              sum(n4, n14),
              sum(n5, n15)
            )
          ) +
          "<br><br>" +
          "<i><u>Final Design Phase</i></u> <br>" +
          ifp2(n6, n16, "Final Design Fee: (") +
          ifp2(
            n7,
            n17,
            "Allowances for Additional Preliminary & Final Design Services: ("
          ) +
          "Sub-total of Final Design Fee: (" +
          ifDel2(n6, n16) +
          ifDel2End(n7, n17) +
          ") = " +
          f(sum(sum(n6, n16), sum(n7, n17))) +
          "<br><br>" +
          ifp2(n8, n18, "Reimbursable for Final design phase: (") +
          ifp2(n9, n19, "Artwork for Final design phase: (") +
          ifp2(n10, n20, "CSS for Final design phase: (") +
          "Final design phase not-to-exceed amount: (" +
          ifDel2(n6 + n16, n7 + n17) +
          ifDel2(n8, n18) +
          ifDel2(n9, n19) +
          ifDel2End(n10, n20) +
          ") = " +
          f(
            sum(
              sum(sum(n6, n16), sum(n7, n17)),
              sum(n8, n18),
              sum(n9, n19),
              sum(n10, n20)
            )
          ) +
          "<br><br>" +
          "Total Preliminary and Final design phase NTE amount: (" +
          f(
            sum(
              sum(sum(n1, n11), sum(n2, n12)),
              sum(n3, n13),
              sum(n4, n14),
              sum(n5, n15)
            )
          ) +
          " + " +
          f(
            sum(
              sum(sum(n6, n16), sum(n7, n17)),
              sum(n8, n18),
              sum(n9, n19),
              sum(n10, n20)
            )
          ) +
          ") = " +
          f(
            sum(
              sum(
                sum(sum(n1, n11), sum(n2, n12)),
                sum(n3, n13),
                sum(n4, n14),
                sum(n5, n15)
              ),
              sum(
                sum(sum(n6, n16), sum(n7, n17)),
                sum(n8, n18),
                sum(n9, n19),
                sum(n10, n20)
              )
            )
          );
      };
      /******************************************************************/
      // Format number into accounting style
      function formatAccounting(value) {
        const number = parseFloat(value);
        if (isNaN(number)) return "";
        const formatted = Math.abs(number).toLocaleString("en-US", {
          style: "currency",
          currency: "USD",
          minimumFractionDigits: 2,
        });
        return number < 0 ? `(${formatted})` : formatted;
      }

      // Parse formatted accounting text to number
      function parseAccounting(str) {
        const cleaned = str.replace(/[\$,()]/g, "");
        const number = parseFloat(cleaned);
        return str.includes("(") ? -Math.abs(number) : number;
      }

      // Apply formatting to all accounting inputs
      function formatAllInputs() {
        document.querySelectorAll(".accounting").forEach((input) => {
          const raw = parseAccounting(input.value);
          input.value = formatAccounting(raw);
        });
      }

      // On blur, format individual input
      document.querySelectorAll(".accounting").forEach((input) => {
        input.addEventListener("blur", () => {
          const raw = parseAccounting(input.value);
          input.value = formatAccounting(raw);
        });

        input.addEventListener("focus", () => {
          // Show plain number while editing
          const raw = parseAccounting(input.value);
          input.value = raw || "";
        });
      });

      // Initial formatting
      formatAllInputs();

      /************************************************************/
    </script>

    <footer>
      <hr />
      <!-- <p> This Task Order application was developed by: Md Hoque.</p> -->
    </footer>
  </body>
</html>
